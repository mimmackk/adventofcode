{
  "hash": "7c02355ed13e6e5c123585b6e9bcef16",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Day 12\"\ndate: 2020-12-12\nauthor:\n  name: https://adventofcode.com/2020/day/12\n  url: https://adventofcode.com/2020/day/12\nexecute:\n  eval: true\n---\n\n\n\n\n## Setup\n\nImport libraries:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(unglue)\n```\n:::\n\n\n\n\nRead text input from file into a dataframe, reading actions & values into separate columns:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninput <- read_lines(\"../input/day12.txt\") |> \n  unglue_data(\"{action=[A-Z]}{value=\\\\d+}\", convert = TRUE)\n```\n:::\n\n\n\n\n## Part 1\n\nDefine the cardinal directions in clockwise order, starting from E:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncardinal_dirs <- c(\"E\", \"S\", \"W\", \"N\")  \n```\n:::\n\n\n\n\nConvert all forward/turn actions into N/S/E/W actions:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsteps <- input |> \n  mutate(\n    turn = value / 90 * case_match(action, \"R\" ~ 1, \"L\" ~ -1, .default = 0),\n    fdir = cardinal_dirs[cumsum(turn) %% 4 + 1]\n  ) |> \n  mutate(action = case_match(action, \"F\" ~ fdir, .default = action)) |> \n  filter(action %in% cardinal_dirs) |> \n  select(action, value)\n```\n:::\n\n\n\n\nCompute the Manhattan distance from the starting point to the final end point:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsteps |> \n  mutate(\n    v = case_match(action, \"N\" ~ value, \"S\" ~ -value, .default = 0),\n    h = case_match(action, \"E\" ~ value, \"W\" ~ -value, .default = 0)\n  ) |> \n  summarize(dist = abs(sum(v)) + abs(sum(h))) |> \n  pull(dist)\n```\n:::\n\n\n\n\n## Part 2\n\nTreat each set of waypoint adjustments followed by a ship movement as a group: \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninput_grouped <- input |> \n  mutate(group_id = cumsum(lag(action, default = \"\") == \"F\"))\n```\n:::\n\n\n\n\nFor each group of waypoint adjustments, apply all shifts and rotations to get a final vector that will determine the direction of the ship's movement:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwp_init <- 1 + 10i\n\nwaypoint <- input_grouped |> \n  filter(action != \"F\") |> \n  transmute(\n    group_id,\n    f = case_match(action, cardinal_dirs ~ \"+\", c(\"L\", \"R\") ~ \"*\"),\n    dir = case_match(action,\n      \"N\" ~  value,\n      \"S\" ~ -value,\n      \"E\" ~  value * 1i,\n      \"W\" ~ -value * 1i,\n      \"L\" ~ cos(-value / 90 * pi / 2) + 1i * sin(-value / 90 * pi / 2),\n      \"R\" ~ cos( value / 90 * pi / 2) + 1i * sin( value / 90 * pi / 2)\n    ),\n    wp = accumulate2(f, dir, .f = \\(x, f, y) get(f)(x, y), .init = wp_init) |> \n      tail(-1)\n  ) |> \n  summarize(wp = last(wp), .by = group_id)\n```\n:::\n\n\n\n\nRejoin the waypoint's relative coordinates at each step back with the ship movement instructions. Execute each pair of direction adjustments and advancements in order to get the final coordinates of the ship:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nend <- input_grouped |> \n  filter(action == \"F\") |> \n  left_join(waypoint, join_by(group_id)) |> \n  mutate(wp = case_when(group_id == 0 & is.na(wp) ~ wp_init, .default = wp)) |> \n  fill(wp, .direction = \"down\") |> \n  mutate(movement = value * wp) |> \n  pull(movement) |> \n  sum()\n```\n:::\n\n\n\n\nCompute the Manhattan distance from the starting point to the final end point:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nabs(Re(end)) + abs(Im(end))\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}