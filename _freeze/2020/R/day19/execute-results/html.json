{
  "hash": "81d5f088a0bca58a2073ad61d8809139",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Day 19\"\ndate: 2020-12-19\nauthor:\n  name: https://adventofcode.com/2020/day/19\n  url: https://adventofcode.com/2020/day/19\nexecute:\n  eval: true\n---\n\n\n\n\n## Setup\n\nImport libraries:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(unglue)\n```\n:::\n\n\n\n\nRead text input from file:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninput <- read_lines(\"../input/day19.txt\", skip_empty_rows = TRUE)\n```\n:::\n\n\n\n\nSeparate input into rules & messages:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmessages <- discard(input, ~ str_starts(.x, \"^\\\\d\"))\n\nrules <- input |>\n  keep(~ str_starts(.x, \"^\\\\d\")) |> \n  unglue_data(\n    c(\n      \"{rule_id}: {rule=[ |0-9]+}\", \n      \"{rule_id}: \\\"{rule}\\\"\"\n    ), \n    convert = FALSE\n  ) |> \n  mutate(rule = str_split(rule, \" \\\\| \")) |> \n  unnest_longer(rule, indices_to = \"alternate\") |> \n  mutate(rule = str_split(rule, \" \")) |> \n  unnest_longer(rule, indices_to = \"order\", values_to = \"rule_component\")\n```\n:::\n\n\n\n\n## Part 1\n\nIteratively build rules using regex to represent 'or' statements:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfinalized <- rules |> \n  filter(str_detect(rule_component, \"^(a|b)+$\")) |> \n  transmute(\n    rule_id, \n    rule_value = rule_component,\n    len = 1,\n  )\n\nwhile (!(0 %in% finalized$rule_id)) {\n  finalized <- rules |> \n    anti_join(finalized, join_by(rule_id)) |> \n    left_join(finalized, join_by(x$rule_component == y$rule_id)) |> \n    filter(all(!is.na(rule_value)), .by = rule_id) |> \n    summarize(\n      rule_value = str_flatten(rule_value), \n      len = sum(len),\n      .by = c(rule_id, alternate)\n    ) |> \n    summarize(\n      rule_value = str_flatten(rule_value, collapse = \"|\"),\n      len = min(len),\n      .by = rule_id\n    ) |> \n    mutate(\n      rule_value = case_when(\n        str_detect(rule_value, \"\\\\|\") ~ str_glue(\"({rule_value})\"),\n        .default = rule_value\n      )\n    ) |> \n    bind_rows(finalized)\n}\n```\n:::\n\n\n\n\nCount how many messages match the final row 0 regex: \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrule_zero <- finalized |> \n  filter(rule_id == 0) |> \n  pull(rule_value)\n\nmessages |> \n  keep(~ str_detect(.x, str_glue(\"^{rule_zero}$\"))) |> \n  length()\n```\n:::\n\n\n\n\n## Part 2\n\nThe modified version of rule 8 could be interpreted as \"1 or more copies of rule 42\".\n\nThe modified version of rule 11 can be interpreted as: \"one or more copies of rule 42, followed by an equal number of copies of rule 31.\"\n\nPutting these together, the new version of rule 0, which was orignally \"8 11\", can now be read as \"n >= 1 copies of rule 31 proceeded by at least n + 1 copies of rule 42.\"\n\nBased on the length of rule 31, rule 42, and the longest message in our input, we can construct all possible combinations of these rules that follow the above pattern:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrule42 <- finalized |> filter(rule_id == 42) |> pull(rule_value)\nrule31 <- finalized |> filter(rule_id == 31) |> pull(rule_value)\nlen_42 <- finalized |> filter(rule_id == 42) |> pull(len)\nlen_31 <- finalized |> filter(rule_id == 31) |> pull(len)\nlen_max <- max(str_length(messages))\n\nrule0 <- expand_grid(n_42 = 1:len_max, n_31 = 1:len_max) |> \n  filter(n_42 >= n_31 + 1) |> \n  filter(n_42 * len_42 + n_31 * len_31 <= len_max) |> \n  pmap_chr(~ str_c(\"^\", rule42, \"{\", ..1, \"}\", rule31, \"{\", ..2, \"}$\"))\n```\n:::\n\n\n\n\nFor all legal variations of the rule 0 regex, check if any messages are valid. Count the total number of possible valid messages. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrule0 |> \n  map(~ str_detect(messages, .x)) |> \n  transpose() |> \n  map_lgl(~ any(unlist(.x))) |> \n  sum()\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}